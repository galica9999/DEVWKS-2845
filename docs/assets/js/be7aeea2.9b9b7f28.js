"use strict";(self.webpackChunklambda_docs=self.webpackChunklambda_docs||[]).push([[65],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>h});var a=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function d(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=a.createContext({}),s=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=s(e.components);return a.createElement(l.Provider,{value:n},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,c=d(e,["components","mdxType","originalType","parentName"]),p=s(t),m=o,h=p["".concat(l,".").concat(m)]||p[m]||u[m]||r;return t?a.createElement(h,i(i({ref:n},c),{},{components:t})):a.createElement(h,i({ref:n},c))}));function h(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,i=new Array(r);i[0]=m;var d={};for(var l in n)hasOwnProperty.call(n,l)&&(d[l]=n[l]);d.originalType=e,d[p]="string"==typeof e?e:o,i[1]=d;for(var s=2;s<r;s++)i[s]=t[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},5549:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>d,toc:()=>s});var a=t(7462),o=(t(7294),t(3905));const r={sidebar_position:4},i="Function Code Part 1",d={unversionedId:"lambda-docs/function-coding-p-1",id:"lambda-docs/function-coding-p-1",title:"Function Code Part 1",description:"With the explanation of the lambda_handler code done, we can now start adding code to the handler to handle an event.",source:"@site/docs/lambda-docs/function-coding-p-1.mdx",sourceDirName:"lambda-docs",slug:"/lambda-docs/function-coding-p-1",permalink:"/DEVWKS-2845/lambda-docs/function-coding-p-1",draft:!1,editUrl:"https://cisco.com/docs/lambda-docs/function-coding-p-1.mdx",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Functions Explanation",permalink:"/DEVWKS-2845/lambda-docs/function-explanation"},next:{title:"Function Code Part 2",permalink:"/DEVWKS-2845/lambda-docs/function-coding-p-2"}},l={},s=[],c={toc:s};function p(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"function-code-part-1"},"Function Code Part 1"),(0,o.kt)("p",null,"With the explanation of the ",(0,o.kt)("inlineCode",{parentName:"p"},"lambda_handler")," code done, we can now start adding code to the handler to handle an event."),(0,o.kt)("p",null,"For our example, we want to receive a ",(0,o.kt)("inlineCode",{parentName:"p"},"port disconnected")," alert and then call out to the Meraki Dashbaord to shutdown the port.  We need to determine what data we need to find from the alert that the Meraki Dashbaord will use to shutdown the port. In the below JSON the highlighted lines will show what data we need:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:"showLineNumbers",showLineNumbers:!0},'{\n  "version": "0.1",\n  "sharedSecret": "",\n  "sentAt": "2023-01-13T19:57:07.307562Z",\n  "organizationId": "000000",\n  "organizationName": "EX net",\n  "organizationUrl": "https://n471.meraki.com/o/000000/manage/organization/overview",\n  "networkId": "N_00000000",\n  "networkName": "Ex net",\n  "networkUrl": "https://n471.meraki.com/ex_net/n/000000/manage/nodes/wired_status",\n  "networkTags": [],\n  //highlight-next-line\n  "deviceSerial": "Q00Y-U00R-T00G",\n  //highlight-next-line\n  "deviceMac": "00:00:00:d7:14:83",\n  //highlight-next-line\n  "deviceName": "Home MX",\n  "deviceUrl": "https://n471.meraki.com/ex_net/n/000000/manage/nodes/new_wired_status",\n  "deviceTags": [],\n  "deviceModel": "MX67W",\n  "alertId": "",\n  "alertType": "Switch port disconnected",\n  //highlight-next-line\n  "alertTypeId": "port_disconnected",\n  "alertLevel": "warning",\n  "occurredAt": "2023-01-13T19:57:07.259607Z",\n  "alertData": {\n    //highlight-next-line\n    "portNum": 3,\n    "description": "Switch port is down",\n    //highlight-next-line\n    "status": "down",\n    "prevStatus": "100 Gbps",\n    "portDesc": "Corp Access"\n  }\n}\n')),(0,o.kt)("p",null,"Looking through the above JSON, we know we need the serial number, port number, and the status of the port."),(0,o.kt)("p",null,"We always want to check if we get the alert we want and if the data we want is there as well. We want to check the alert type, if the metatdata exists, and the status of the port before we continue running the function. Otherwise the function should exit as quickly as possible.\nIf all the checks pass, we will import the python ",(0,o.kt)("inlineCode",{parentName:"p"},"requests")," library to make the API call to Meraki later."),(0,o.kt)("p",null,"We will add the highlighted lines to the ",(0,o.kt)("inlineCode",{parentName:"p"},"lambda_handler"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:"title='lambda_function.py showLineNumbers'",title:"'lambda_function.py","showLineNumbers'":!0},"import json\n\ndef lambda_handler(event, context):\n  #remove-line\n    # TODO implement\n    #add-line\n    if event['alertTypeId'] != 'port_disconnected':\n#add-line\n    return {\n      #add-line\n      'statusCode': 200,\n      #add-line\n      'body': json.dumps('Not a downed port')\n      #add-line\n    }\n    #add-line\n  if 'alertData' not in event:\n    #add-line\n    return {\n      #add-line\n      'statusCode': 200,\n      #add-line\n      'body': json.dumps('Not a downed port')\n      #add-line\n    }\n    #add-line\n    if event['alertData']['status'] == 'down':\n      #add-line\n        import requests\n    #add-line\n    else:\n      #add-line\n      return {\n          #add-line\n          'statusCode': 200,\n          #add-line\n          'body': json.dumps('Not a downed port')\n          #add-line\n        }\n\n  #remove-line\n    return {\n          #remove-line\n            'statusCode': 200,\n          #remove-line\n            'body': json.dumps('Not a downed port')\n          #remove-line\n        }\n")),(0,o.kt)("p",null,"Now that we know the port will be down and the ",(0,o.kt)("inlineCode",{parentName:"p"},"requests")," library is imported, we now need to store the information we need to make the API call."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:"title='lambda_function.py showLineNumbers'",title:"'lambda_function.py","showLineNumbers'":!0},"import json\n\ndef lambda_handler(event, context):\n  if event['alertTypeId'] != 'port_disconnected':\n    return {\n      'statusCode': 200,\n      'body': json.dumps('Not a downed port')\n    }\n    \n  if 'alertData' not in event:\n    return {\n      'statusCode': 200,\n      'body': json.dumps('Not a downed port')\n    }\n  if event['alertData']['status'] == 'down':\n    import requests\n    #add-line\n    deviceSerial = str(event['deviceSerial'])\n    #add-line\n    deviceMac = event['deviceMac']\n    #add-line\n    deviceName = event['deviceName']\n    #add-line\n    portNumber = str(event['alertData']['portNum'])\n  else:\n    return {\n        'statusCode': 200,\n        'body': json.dumps('Not a downed port')\n      }\n      \n")))}p.isMDXComponent=!0}}]);